# Техническое задание

## Описание задачи

Необходимо разработать приложение для обработки электронных таблиц, которое принимает файлы с кодами, находит соответствующие штрихкоды в справочнике и формирует результирующие файлы.

## Входные данные

### 1. Входящие файлы

Приложение должно принимать файлы в формате электронных таблиц (расширения .xlsx или .xls).

**Структура входящего файла:**

- Первая строка может содержать заголовки (игнорируется при обработке)
- Со второй строки в столбце B (вторая колонка) находятся коды для обработки
- Каждый код располагается в отдельной ячейке столбца B
- Пустые ячейки в столбце B игнорируются
- Количество строк с кодами может быть любым

**Название файла:**

- Название файла должно содержать артикул в начале
- Артикул определяется как первое слово в названии файла (до первого пробела)
- Расширение файла (.xlsx или .xls) не учитывается при извлечении артикула
- Примеры названий: "G0418 - 61 штука.xlsx", "A1234 файл.xls"

### 2. Справочник артикулов и штрихкодов

Приложение должно иметь доступ к справочнику, содержащему соответствие между артикулами и штрихкодами.

**Структура справочника:**

- Первая строка содержит заголовки (игнорируется)
- Со второй строки начинаются данные
- В столбце A (первая колонка) находятся артикулы
- В столбце F (шестая колонка) находятся соответствующие штрихкоды
- Одна строка содержит одну пару артикул-штрихкод

**Требования к справочнику:**

- Справочник должен быть доступен для чтения
- Данные справочника должны кэшироваться для оптимизации производительности
- Время жизни кэша: 8 часов
- При отсутствии данных в справочнике или ошибке доступа приложение должно обрабатывать ситуацию соответствующим образом

## Выходные данные

### Результирующий файл

Для каждого успешно обработанного входящего файла создается новый файл в формате электронных таблиц (.xlsx).

**Структура результирующего файла:**

- Первая строка, столбец A: текст "коды"
- Вторая строка, столбец A: штрихкод, соответствующий артикулу из названия входящего файла
- Третья и последующие строки, столбец A: коды из входящего файла в том же порядке, в котором они были извлечены

**Название результирующего файла:**

- Формат: "codes_<артикул>.xlsx"
- Пример: "codes_G0418.xlsx"

### Сообщения пользователю

Приложение должно отправлять пользователю следующие сообщения:

1. **При успешной обработке:**

   - Отправляется результирующий файл
2. **При ошибках:**

   - Если файл не является электронной таблицей: сообщение о необходимости отправить файл в формате .xlsx или .xls
   - Если артикул не найден в справочнике: сообщение с указанием артикула, который не был найден
   - Если в файле не найдено кодов в столбце B: соответствующее сообщение
   - При ошибках обработки файла: сообщение об ошибке с просьбой проверить формат файла
   - При общих ошибках: сообщение о произошедшей ошибке
3. **Групповая обработка:**

   - При отправке нескольких файлов подряд (в течение короткого промежутка времени) должно отправляться итоговое сообщение о завершении обработки всех файлов
   - Итоговое сообщение содержит количество обработанных файлов
   - Группировка файлов происходит автоматически, если между отправками прошло не более 3 секунд
   - Каждый файл обрабатывается независимо и результат отправляется сразу после обработки

## Функциональные требования

### Основной функционал

1. **Прием файлов:**

   - Приложение должно принимать файлы через интерфейс мессенджера Telegram
   - Поддерживаются форматы .xlsx и .xls
   - Проверка формата файла по расширению
2. **Извлечение артикула:**

   - Извлечение артикула из названия файла (первое слово до пробела)
   - Обработка названий с различными разделителями и пробелами
3. **Чтение кодов:**

   - Чтение данных из столбца B начиная со второй строки
   - Пропуск пустых ячеек
   - Сохранение порядка кодов
4. **Поиск штрихкода:**

   - Поиск штрихкода в справочнике по артикулу
   - Обработка ситуации, когда артикул не найден
5. **Формирование результата:**

   - Создание нового файла с указанной структурой
   - Сохранение файла с корректным названием
6. **Отправка результата:**

   - Отправка результирующего файла пользователю
   - Очистка временных файлов после отправки

### Дополнительный функционал

1. **Кэширование справочника:**

   - Кэширование данных справочника для уменьшения количества обращений
   - Время жизни кэша: 8 часов
   - Автоматическое обновление кэша по истечении времени
2. **Групповая обработка:**

   - Автоматическое определение группы файлов, отправленных подряд
   - Отправка итогового сообщения после обработки всех файлов в группе
   - Таймаут группировки: 3 секунды после последнего файла
3. **Обработка ошибок:**

   - Корректная обработка всех типов ошибок
   - Информативные сообщения пользователю
   - Очистка временных файлов даже при ошибках

## Требования к обработке данных

1. **Валидация входных данных:**

   - Проверка формата файла
   - Проверка наличия данных в столбце B
   - Проверка наличия артикула в справочнике
2. **Обработка граничных случаев:**

   - Файлы без кодов
   - Файлы с пустыми ячейками
   - Файлы с некорректным форматом
   - Отсутствие артикула в справочнике
   - Ошибки доступа к справочнику

## Ограничения и допущения

1. Все файлы обрабатываются последовательно
2. Название файла может содержать кириллицу и специальные символы
3. Коды в столбце B могут быть любого формата (текст, числа)
4. Штрихкоды в справочнике представлены в виде строк

## Язык разработки

Приложение должно быть разработано на языке Python/node.js
